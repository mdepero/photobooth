<!doctype html>
<html lang="en">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>Cam Snap</title>
		<script src="https://code.jquery.com/jquery-3.1.0.js" integrity="sha256-slogkvB1K3VOkzAI8QITxV3VzpOnkeNVsKvtkYLMjfk=" crossorigin="anonymous"></script>
		<script type="text/javascript" src="webcam.js"></script>
		<script language="JavaScript">
		
		var remoteServerLocation = 'http://jshalk.com/photobooth/upload.php';
		
		
			function take_snapshot() {
				Webcam.snap(function(data_uri) {
				document.getElementById('results').innerHTML = '<img id="base64image" src="'+data_uri+'"/><button onclick="SaveSnap();">Save Snap</button>';
			});
			}
			function ShowCam(){
				Webcam.set({
				width: 720,
				height: 540,
				image_format: 'jpeg',
				jpeg_quality: 100
			});
			Webcam.attach('#my_camera');
			}
			function SaveSnap(){
				document.getElementById("loading").innerHTML="Saving, please wait...";
				var file =  document.getElementById("base64image").src;
				$.ajax({
					url: "upload.php",
					type: "POST",
					contentType: "text/plain",
					data: file,
					success: function(result){
						alert("returned:"+result);
					}
				});

				/*var formdata = new FormData();
				formdata.append("base64image", file);
				var ajax = new XMLHttpRequest();
				ajax.addEventListener("load", function(event) { uploadcomplete(event);}, false);
				ajax.open("POST", "upload.php");
				ajax.send(formdata);
				*/
			}
			function uploadcomplete(event){
				document.getElementById("loading").innerHTML="";
				var image_return=event.target.responseText;
				var showup=document.getElementById("uploaded").src=image_return;
			}
			window.onload= ShowCam;

		</script>
		<style type="text/css">
		html,body{
		height: 100%;width:100%;
		}
		*{
		padding:0;margin:0; 
		}
		video {
		object-fit:cover;
		}
		input{
			position: absolute;
			top:0;
			left:0;
			z-index: 5;
		}
		.container{display:inline-block;width:320px;}
		#Cam{background:rgb(255,255,215);}#Prev{background:rgb(255,255,155);}#Saved{background:rgb(255,255,55);}
		</style>
	</head>
	<body>
			<div id="my_camera"></div><form><input type="button" value="Snap It" onClick="take_snapshot()"></form>

	</body>
</html>