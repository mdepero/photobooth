<!doctype html>
<html lang="en">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>Smucker's Surfboard Photobooth</title>
		<script src="https://code.jquery.com/jquery-3.1.0.js" integrity="sha256-slogkvB1K3VOkzAI8QITxV3VzpOnkeNVsKvtkYLMjfk=" crossorigin="anonymous"></script>
		<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
		<script type="text/javascript" src="webcam.js"></script>


		<script language="JavaScript">
		
		var remoteServerLocation = 'http://jshalk.com/photobooth/upload.php';
		var aspect_ratio = (3.0/4.0); // aspect ratio of the webcam
		var image_uri = "";// global var


			function launchIntoFullscreen(element) {
			  if(element.requestFullscreen) {
			    element.requestFullscreen();
			  } else if(element.mozRequestFullScreen) {
			    element.mozRequestFullScreen();
			  } else if(element.webkitRequestFullscreen) {
			    element.webkitRequestFullscreen();
			  } else if(element.msRequestFullscreen) {
			    element.msRequestFullscreen();
			  }
			}

		
			// asynchronous non-sense
			function take_snapshot() {
				$("#snap_button").hide();
				$("#text").html("3");
				setTimeout(function(){
					$("#text").html("2");
					setTimeout(function(){
						$("#text").html("1");
						setTimeout(actually_take_snapshot,1000)
					},1000)
				},1000)
			}
			function actually_take_snapshot(){
				$("#text").html("");
				$("#snap_button").show();
				Webcam.snap(function(data_uri) {
					document.getElementById('snap').style.backgroundImage = "url('"+data_uri+"')";
					image_uri = data_uri;
				});
			}
			function ShowCam(){

				Webcam.set({
				width: screen.width,
				height: screen.width*aspect_ratio,
				dest_width: screen.width,
				dest_heiht: screen.height,
				crop_width: screen.width,
				crop_height: screen.height,
				image_format: 'jpeg',
				flip_horiz: true,
				jpeg_quality: 100
				});
				Webcam.attach('#my_camera');
			}
			function SaveSnap(){
				//document.getElementById("loading").innerHTML="Saving, please wait...";
				var file =  document.getElementById("base64image").src;
				$.ajax({
					url: "upload.php",
					type: "POST",
					contentType: "text/plain",
					data: file,
					success: function(result){
						alert("returned:"+result);
					}
				});

				/*var formdata = new FormData();
				formdata.append("base64image", file);
				var ajax = new XMLHttpRequest();
				ajax.addEventListener("load", function(event) { uploadcomplete(event);}, false);
				ajax.open("POST", "upload.php");
				ajax.send(formdata);
				*/
			}
			function uploadcomplete(event){
				document.getElementById("loading").innerHTML="";
				var image_return=event.target.responseText;
				var showup=document.getElementById("uploaded").src=image_return;
			}


			$(document).ready(ShowCam);

			function start(){
				$("#start").hide();

				// Launch fullscreen for browsers that support it!
				launchIntoFullscreen(document.documentElement); // the whole page
			}


		</script>
		<style type="text/css">
		html,body{
		height: 100%;width:100%;overflow:hidden;
		}
		*{
		padding:0;margin:0; 
		}
		#overlay_frame{
			position: absolute;
			left:0px;
			top:0px;
			width:100vw;
			height:100vh;
			z-index: 6;
		}
		/*video {
		object-fit:cover;
		}*/
		#snap{
			position: absolute;
			left:0px;
			top:0px;
			width:100vw;
			height:100vh;
			background-size:contain;
			background-repeat: no-repeat;
			background-position: 50% 50%;
			z-index: 4;
		}
		#button{
			position: absolute;
			font-family: arial;
			font-weight: bold;
			font-style: italic;
			bottom:40px;
			left:0px;
			z-index: 10;
			width: 100%;
			font-size: 40px;
		}
		#Cam{background:rgb(255,255,215);}#Prev{background:rgb(255,255,155);}#Saved{background:rgb(255,255,55);}
		</style>
	</head>
	<body>
			<img src="frame.png" id="overlay_frame">
			<div id="my_camera"></div>
			<div id="snap"></div>
			<div id="button" class="text-center">
				<input type="button" class="btn btn-large btn-info" id="start" value="START" onclick="start();">
				<input type="button" class="btn btn-large btn-primary" id="snap_button" value="Capture Your Moment" onclick="take_snapshot()">
				<span id="text"></span>
			</div>



	</body>
</html>
